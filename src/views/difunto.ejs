<%- include("partials/_header") %>

<!-- <section class="dashboard">
  <div class="top">
  </div>

  <div class="dash-content">
      <div class="overview">
          <div class="title">
              <i class="uil uil-tachometer-fast-alt"></i>
              <span class="text">Inicio</span>
          </div>

          <div class="boxes">
              <div class="box box1">
                  <i class="uil uil-"></i>
                  <span class="text">Total de gavetas</span>
                  <span class="number"><%= allCement %></span>
              </div>
              <div class="box box2">
                  <i class="uil uil-"></i>
                  <span class="text">Panteón nuevo</span>
                  <span class="number"><%= newCement %></span>
              </div>
              <div class="box box3">
                  <i class="uil uil-"></i>
                  <span class="text">Panteón viejo</span>
                  <span class="number"><%= oldCement %></span>
              </div>
          </div>
      </div>

    <div class="activity">
        <div class="title">
            <i class="uil uil-file-alt"></i>
            <span class="text">Todos los registros</span>
        </div>

        <div class="activity-data">
            <div class="data names">
                <span class="data-title">N. gaveta</span>
                <% if (difunto) { %> <% for(var i = 0; i < difunto.length; i++) {
                  %>
                  <span class="data-list"><%= difunto[i].id %></span>
                <% } %> <% } %>
            </div>
            <div class="data email">
              <span class="data-title">Nombre del difunto</span>
                <% if (difunto) { %> <% for(var i = 0; i < difunto.length; i++) {
                  %>
                  <span class="data-list"><%= difunto[i].name %></span>
                <% } %> <% } %>
            </div>            
            <div class="data joined">
              <span class="data-title">Sección</span>
              <% if (difunto) { %>
                <% for(var i = 0; i < difunto.length; i++) { %>
                  <span class="data-list"><%= difunto[i].seccion %></span>
                <% } %>
              <% } %>
            </div>
            <div class="data floors">
              <span class="data-title">Pisos</span>
              <% if (difunto) { %> <% for(var i = 0; i < difunto.length; i++) {
                %>
                <span class="data-list"><%= difunto[i].pisos %></span>
              <% } %> <% } %>
            </div>
            <div class="data type">
                <span class="data-title">N. anterior</span>
                <% if (difunto) { %> <% for(var i = 0; i < difunto.length; i++) {
                  %>
                  <span class="data-list"><%= difunto[i].num %></span>
                <% } %> <% } %>
            </div>

            <div class="data status">
                <span class="data-title">Fecha</span>
                <% if (difunto) { %>
                  <% for(var i = 0; i < difunto.length; i++) { %>
                    <span class="data-list"><%= difunto[i].fecha %></span>
                  <% } %>
                <% } %>
            </div>

        </div>
        
    </div>
  </div>
</section> -->

<section id="content">
  <main>
    <div class="head-title">
      <div class="left">
        <h1>Inicio</h1>
        <ul class="breadcrumb">
          <li>
          </li>
          <li>
          </li>
        </ul>
      </div>
      <a href="#" class="btn-download">
        <i class='uil uil-download-alt' ></i>
        <span class="text">Descargar PDF</span>
      </a>
    </div>
  
    <ul class="box-info">
      <li>
        <i class='uil uil-building'></i>
        <span class="text">
          <h3 id="totalCement"><%= allCement %></h3>
          <p>Total de gavetas</p>
        </span>
      </li>
      <li>
        <i class='uil uil-trees'></i>
        <span class="text">
          <h3 id="newCement"><%= newCement %></h3>
          <p>Panteón nuevo</p>
        </span>
      </li>
      <li>
        <i class='uil uil-archway'></i>
        <span class="text">
          <h3 id="oldCement"><%= oldCement %></h3>
          <p>Panteón viejo</p>
        </span>
      </li>
      <li>
        <i class='uil uil-check-circle'></i>
        <span class="text">
          <h3 id="availableCement"><%= availableCement %></h3>
          <p>Disponibles</p>
        </span>
      </li>
    </ul>
    
    
  
  
    <div class="table-data">
      <div class="order">
        <div class="head">
          <h3>Recientes</h3>
          <!-- <i class='bx bx-search' ></i>
          <i class='bx bx-filter' ></i> -->
        </div>
        <div class="table-container">
          <table class="scroll-table">
            <thead>
              <tr>
                <th>Nombre</th>
                <th>Fecha</th>
                <th>Panteón</th>
              </tr>
            </thead>
            <tbody>
              <% if (difunto) { %> <% for(var i = 0; i < difunto.length; i++) {
                %>
              <tr>
                <td>
                  <p><%= difunto[i].name %></p>
                </td>
                <td><%= difunto[i].fecha %></td>
                <td><span class="status <%= difunto[i].panteon === 'VIEJO' ? 'viejo' : 'nuevo' %>"><%= difunto[i].panteon %></span></td>
              </tr>
              <% } %> <% } %>
            </tbody>
          </table>
        </div>
      </div>
      <div class="todo">
        <div class="head">
          <h3>Modificados</h3>
          <!-- <i class='bx bx-plus' ></i>
          <i class='bx bx-filter' ></i> -->
        </div>
        <ul class="todo-list">
          <% recentChanges.forEach((item) => { %>
            <li class="completed">
              <p><%= item.name %></p>
              <i class="uil uil-elipsis-double-v-alt view-btn" data-id="<%= item.id %>"></i>
            </li>
          <% }) %>
        </ul>        
      </div>
    </div>
  </main>
</section>
<ul class="recent-list">
  <% recentChanges.forEach((item, index) => { %>
    <li>
      <span><%= item.name %></span>
      <button class="view-btn"  data-id="<%= item.id %>" data-index="<%= index %>">
        <i class="uil uil-eye"></i>
      </button>
    </li>
  <% }) %>
</ul>


<script src="/socket.io/socket.io.js"></script>

<script>
  document.addEventListener("DOMContentLoaded", () => {
  const socket = io();

  socket.on("connect", () => {
    console.log("Conectado a WebSocket con ID:", socket.id);
  });

  socket.on("nuevoRegistro", (data) => {
    console.log("Datos recibidos:", data); // <-- aquí debe aparecer
    const tbody = document.querySelector(".scroll-table tbody");
    const tr = document.createElement("tr");

    // Nombre con <p>
    const tdNombre = document.createElement("td");
    const pNombre = document.createElement("p");
    pNombre.textContent = data.name;
    tdNombre.appendChild(pNombre);

    // Fecha
    const tdFecha = document.createElement("td");
    tdFecha.textContent = data.fecha;

    // Panteón con <span> y clase dinámica
    const tdPanteon = document.createElement("td");
    const spanPanteon = document.createElement("span");
    spanPanteon.textContent = data.panteon;
    spanPanteon.className = `status ${data.panteon === "VIEJO" ? "viejo" : "nuevo"}`;
    tdPanteon.appendChild(spanPanteon);

    // Agrega todos los <td> al <tr>
    tr.appendChild(tdNombre);
    tr.appendChild(tdFecha);
    tr.appendChild(tdPanteon);

    // Agrega la fila al final del tbody
    tbody.appendChild(tr);
    document.getElementById("totalCement").textContent = data.allCement;
    document.getElementById("newCement").textContent = data.newCement;
    document.getElementById("oldCement").textContent = data.oldCement;
    document.getElementById("availableCement").textContent = data.availableCement;

    })
});
</script>


<%- include("partials/_createDifuntos") %>
<%- include("partials/_seeDifunto") %>
<%- include("partials/_footer") %>
