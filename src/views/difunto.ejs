<%- include("partials/_header") %>

<section id="content">
  <main>
    <div class="head-title">
      <div class="left">
        <h1>Inicio</h1>
        <ul class="breadcrumb">
          <li>
          </li>
          <li>
          </li>
        </ul>
      </div>
      <div class="button-download">
        <div class="content">
          <i class='bx bx-cloud-download'></i>
          <span class="button-text">Descargar Excel</span>
        </div>
      </div>
    </div>
  
    <ul class="box-info">
      <li>
        <i class='uil uil-building'></i>
        <span class="text">
          <h3 id="totalCement"><%= allCement %></h3>
          <p>Total de gavetas</p>
        </span>
      </li>
      <li>
        <i class='uil uil-trees'></i>
        <span class="text">
          <h3 id="newCement"><%= newCement %></h3>
          <p>Panteón nuevo</p>
        </span>
      </li>
      <li>
        <i class='uil uil-archway'></i>
        <span class="text">
          <h3 id="oldCement"><%= oldCement %></h3>
          <p>Panteón viejo</p>
        </span>
      </li>
      <li>
        <i class='uil uil-check-circle'></i>
        <span class="text">
          <h3 id="availableCement"><%= availableCement %></h3>
          <p>Disponibles</p>
        </span>
      </li>
    </ul>
    
    
  
  
    <div class="table-data">
      <div class="order">
        <div class="head">
          <h3>Recientes</h3>
          <!-- <i class='bx bx-search' ></i>
          <i class='bx bx-filter' ></i> -->
        </div>
        <div class="table-container">
          <table class="scroll-table">
            <thead>
              <tr>
                <th>Nombre</th>
                <th>Fecha</th>
                <th>Panteón</th>
              </tr>
            </thead>
            <tbody>
              <% if (difunto) { %> <% for(var i = 0; i < difunto.length; i++) {
                %>
              <tr>
                <td>
                  <p><%= difunto[i].name %></p>
                </td>
                <td><%= difunto[i].fecha %></td>
                <td><span class="status <%= difunto[i].panteon === 'VIEJO' ? 'viejo' : 'nuevo' %>"><%= difunto[i].panteon %></span></td>
              </tr>
              <% } %> <% } %>
            </tbody>
          </table>
        </div>
      </div>
      <div class="todo">
        <div class="head">
          <h3>Responsables</h3>
          <!-- <i class='bx bx-plus' ></i>
          <i class='bx bx-filter' ></i> -->
        </div>
        
      </div>
    </div>
  </main>
</section>



<script src="/socket.io/socket.io.js"></script>
<script src="/js/inicio-socket.js"></script>
<script src="../custom-scripts.js" defer></script>

<!-- <script>
  const button = document.querySelector(".button-download");
  const fileUrl = "/export-excel"; // 👈 ruta a tu controlador en Express

  button.addEventListener("click", () => {
    // Activa animación
    button.classList.add("active");

    // Espera a que la animación termine
    setTimeout(() => {
      button.classList.remove("active");

      // Cambia icono y texto
      button.querySelector("i").classList.replace("uil-download-alt", "uil-check-circle");
      button.querySelector("span").innerText = "Completado";

      // ⚡ Inicia descarga con la ruta del controlador
      const link = document.createElement("a");
      link.href = fileUrl;
      link.setAttribute("download", "difuntos.xlsx"); // 👈 nombre sugerido
      document.body.appendChild(link);
      link.click();
      link.remove();
    }, 2000); // ajusta al tiempo de tu animación CSS
  });
</script> -->
<script>
  const button = document.querySelector(".button-download");
  const icon = button.querySelector("i");
  const text = button.querySelector("span");

  button.addEventListener("click", (e) => {
    e.preventDefault(); // evita descarga inmediata
    if (button.classList.contains("disabled")) return; // 🚫 evita múltiples clics

    button.classList.add("active", "disabled"); // 🔒 bloquea
    button.style.pointerEvents = "none"; // desactiva clicks

    // ⏱ Espera a que termine la barra (2s en este ejemplo)
    setTimeout(() => {
      button.classList.remove("active");
      icon.classList.replace("bx-cloud-download", "bx-check-circle");
      text.innerText = "Completado";

      // 👉 Dispara la descarga
      window.location.href = "/export-excel";

      // ⏱ Después de 10 segundos vuelve al estado original
      setTimeout(() => {
        icon.classList.replace("bx-check-circle", "bx-cloud-download");
        text.innerText = "Descargar Excel";

        // 🔓 desbloquea
        button.classList.remove("disabled");
        button.style.pointerEvents = "auto";
      }, 10000);

    }, 2000); // duración animación de progreso
  });
</script>



<%- include("partials/_createDifuntos") %>
<%- include("partials/_seeDifunto") %>
<%- include("partials/_footer") %>
