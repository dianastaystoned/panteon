<script>
    document.addEventListener("keyup", (e) => {
  if (e.target.matches("#buscador")) {
    if (e.key === "Escape") e.target.value = "";

    const search = e.target.value.toUpperCase();

    const nombres = document.querySelectorAll(".email .nombre");

    nombres.forEach((nombre, index) => {
      const seccion = document.querySelectorAll(".joined .seccion")[index].textContent.toUpperCase();
      const panteon = document.querySelectorAll(".status .panteon")[index].textContent.toUpperCase();
      const gabeta = document.querySelectorAll(".names .data-list")[index].textContent.toUpperCase();
      const num = document.querySelectorAll(".type .num")[index].textContent.toUpperCase();

      const coincide =
        nombre.textContent.toUpperCase().includes(search) ||
        seccion.includes(search) ||
        panteon.includes(search) ||
        gabeta.includes(search) ||
        num.includes(search);

      // Mostrar u ocultar los datos en todas las columnas
      document.querySelectorAll(".names .data-list")[index].style.display = coincide ? "" : "none";
      document.querySelectorAll(".email .nombre")[index].style.display = coincide ? "" : "none";
      document.querySelectorAll(".joined .seccion")[index].style.display = coincide ? "" : "none";
      document.querySelectorAll(".floors .data-list")[index].style.display = coincide ? "" : "none";
      document.querySelectorAll(".type .num")[index].style.display = coincide ? "" : "none";
      document.querySelectorAll(".status .panteon")[index].style.display = coincide ? "" : "none";
    });
  }
});

const openModalBtn = document.getElementById("openModal");
const modal = document.getElementById("modal");
const closeModalBtn = document.getElementById("closeModal");

openModalBtn.addEventListener("click", (e) => {
  e.preventDefault();
  modal.classList.add("show");
});

closeModalBtn.addEventListener("click", () => {
  modal.classList.remove("show");
});

document.addEventListener('DOMContentLoaded', () => {
  const modaledit = document.getElementById("modaledit");
  const editForm = document.getElementById("editForm");

  const closeModalEdit = document.getElementById("closeModalEdit");
  closeModalEdit.addEventListener("click", () => {
    modaledit.classList.remove("show");
  });


  document.querySelectorAll(".data-list").forEach((el) => {
    el.addEventListener("dblclick", async () => {
      const id = el.getAttribute("data-id");
      if (!id) {
        alert("No hay ID asignado a este elemento.");
        return;
      }

      try {
        const res = await fetch(`/api/difunto/${id}`);
        if (!res.ok) throw new Error("No se pudo obtener el registro");

        const difunto = await res.json();

        // Actualizar t√≠tulo modal
        document.getElementById("modalTitle").textContent = `Editar registro de ${difunto.name}`;

        // Llenar formulario
        editForm.action = `/update/${difunto.id}`;
        console.log("Datos recibidos:", difunto);
        editForm.name.value = difunto.name || '';
        editForm.seccion.value = difunto.seccion || '';
        editForm.fecha.value = difunto.fecha || '';
        editForm.panteon.value = difunto.panteon || '';
        editForm.pisos.value = difunto.pisos !== null && difunto.pisos !== undefined ? difunto.pisos : '';
        editForm.num.value = difunto.num !== null && difunto.num !== undefined ? difunto.num : '';


        // Mostrar modal
        modaledit.classList.add("show");
      } catch (error) {
        alert(error.message);
      }
    });
  });

});
  </script>
  
</body>
</html>
